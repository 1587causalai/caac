# 理论设计

## 1. 背景与动机

CAAC-SPSFT（Cauchy Abduction Action Classification with Stochastic Pathway Selection and Fixed Thresholds）是对CAAR（Cauchy Abduction Action Regression）回归模型的扩展，旨在将柯西分布的因果推断框架应用于分类任务。

### 1.1 设计目标

CAAC-SPSFT的核心设计目标是构建一个统一的因果大模型架构，能够同时处理分类和回归任务。具体包括：

- **利用柯西分布的重尾特性**来建模潜在变量，提高模型对异常值的鲁棒性
- **构建具有封闭解析NLL**（负对数似然）的模型，便于梯度优化
- **避免采样过程**，保证训练和推理的确定性
- **保持模型的因果解释性**
- **实现机制不变性**：输入数据 $x$ 仅应影响因果表征的生成，而因果表征到分类结果的映射机制应该是固定的、不依赖于特定输入的

### 1.2 关键约束

CAAC-SPSFT设计的核心约束是**机制不变性**：输入 $x$ 仅影响因果表征 $C$ 的参数生成，从因果表征到分类结果的所有决策机制都是全局固定的。

## 2. 设计演进过程

CAAC-SPSFT的设计经历了多个方案的演进，每个方案都解决了前一个方案的关键问题：

### 2.1 初始多层柯西架构的挑战

最初设想通过多层嵌套的柯西分布和ALR（Additive Log-Ratio）变换构建分类模型：

$$x \rightarrow h(x) \rightarrow P(C|x) \sim \text{MCauchy}(\mu_C(h), \gamma_C(h))$$

**数学障碍**：为获得封闭的NLL，需要计算多层期望：

$$P(Y=j|x) = \mathbb{E}_{C|x} \left[ \mathbb{E}_{\varepsilon|x} \left[ \mathbb{E}_{Z_1...Z_{K-1} | V(C,\varepsilon)} \left[ \text{ALR}_j(Z_1...Z_{K-1}) \right] \right] \right]$$

这种多层期望计算涉及没有初等函数封闭解的积分，无法满足"封闭解析NLL"的核心要求。

### 2.2 动态阈值方案的局限

后续方案通过基于柯西分布的一维得分和分段分类获得了封闭解析NLL，但存在**决策阈值依赖于输入数据**的问题，违背了机制不变性原则。

### 2.3 CAAC-SPSFT：最终解决方案

CAAC-SPSFT通过**固定阈值机制**彻底解决了机制不变性问题，实现了所有设计目标的完美平衡。

## 3. CAAC-SPSFT架构

### 3.1 完整数学框架

#### 3.1.1 输入到因果表征

$$x \rightarrow h(x) \rightarrow (\vec{\mu}_C(h), \vec{\gamma}_C(h))$$

其中 $\vec{\mu}_C(h) = (\mu_{C_1}(h), ..., \mu_{C_{d_c}}(h))$ 和 $\vec{\gamma}_C(h) = (\gamma_{C_1}(h), ..., \gamma_{C_{d_c}}(h))$ 定义了 $d_c$ 维独立柯西因果表征的分布参数。

#### 3.1.2 因果表征到多路径得分

对于每条路径 $j \in \{1, ..., K\}$，通过线性变换生成路径特定的柯西得分参数：

**位置参数**：
$$\mu_{S_j}(h) = (\vec{W}_{\mu}^{(j)})^T \vec{\mu}_C(h) + b_{\mu}^{(j)}$$

**尺度参数**：
$$\gamma_{S_j}(h) = \sum_{i=1}^{d_c} |W_{\gamma,i}^{(j)}| \gamma_{C_i}(h) + \gamma_{\epsilon_0}^{(j)}$$

其中 $\gamma_{\epsilon_0}^{(j)} = \exp(\text{raw\_}\gamma_{\epsilon_0}^{(j)})$ 确保正性。

#### 3.1.3 固定决策机制

**路径选择概率**（全局固定）：
$$\pi_j = \frac{\exp(l_j)}{\sum_{p=1}^K \exp(l_p)}$$

**分类阈值**（全局固定）：
$$\vec{\theta}^* = (\theta_1^* < \theta_2^* < ... < \theta_{K-1}^*)$$

#### 3.1.4 最终分类概率

每条路径 $j$ 给出的类别 $k$ 概率：
$$P(Y=k|M=j, x) = F_{S_j}(\theta_k^*) - F_{S_j}(\theta_{k-1}^*)$$

其中柯西CDF为：
$$F_{S_j}(s) = \frac{1}{2} + \frac{1}{\pi} \arctan\left(\frac{s - \mu_{S_j}(h)}{\gamma_{S_j}(h)}\right)$$

最终混合概率：
$$P(Y=k|x) = \sum_{j=1}^K \pi_j \cdot P(Y=k|M=j, x)$$

### 3.2 二分类具体实现

对于二分类问题（$K=2$），只需要一个固定阈值 $\theta_1^*$：

**类别1概率**：
$$P(Y=1|M=j,x) = F_{S_j}(\theta_1^*) = \frac{1}{2} + \frac{1}{\pi} \arctan\left(\frac{\theta_1^* - \mu_{S_j}(h)}{\gamma_{S_j}(h)}\right)$$

**类别2概率**：
$$P(Y=2|M=j,x) = 1 - F_{S_j}(\theta_1^*) = \frac{1}{2} - \frac{1}{\pi} \arctan\left(\frac{\theta_1^* - \mu_{S_j}(h)}{\gamma_{S_j}(h)}\right)$$

**最终概率**：
$$P(Y=k|x) = \sum_{j=1}^K \pi_j \cdot P(Y=k|M=j,x)$$

## 4. 核心优势

### 4.1 封闭解析NLL

CAAC-SPSFT的损失函数具有封闭形式：

$$\mathcal{L} = -\sum_{i=1}^N \log P(Y=y_i|x_i)$$

其中每个概率项都可以通过解析公式计算，无需数值积分或采样。

### 4.2 机制不变性

- **数据影响局限化**：输入 $x$ 仅影响因果表征 $C$ 的参数生成
- **机制固定化**：从因果表征到分类结果的所有决策机制都是全局固定的
- **多路径混合**：通过 $K$ 个并行的"解读路径"增强模型表达能力

### 4.3 因果解释性

模型的分层结构提供了清晰的因果解释路径：
1. 输入特征通过编码器生成潜在因果表征
2. 因果表征通过固定的映射机制产生分类结果
3. 每条路径可以理解为不同的"因果视角"

## 5. 与CAAR的统一

CAAC-SPSFT与CAAR共享相同的因果表征生成机制，为构建统一的因果大模型架构奠定了基础：

- **共同的因果表征**：两者都使用柯西分布建模潜在因果状态
- **不同的输出机制**：CAAR直接输出连续值，CAAC-SPSFT通过固定阈值输出分类概率
- **统一的优化目标**：都追求封闭解析的损失函数和鲁棒的预测性能

## 6. 参数设计要点

### 6.1 关键超参数

- **因果表征维度** $d_c$：决定模型的表达能力
- **路径数量** $K$：平衡表达能力与计算复杂度
- **固定阈值** $\vec{\theta}^*$：需要合理初始化并通过约束学习

### 6.2 训练稳定性

- **阈值约束**：通过参数化确保 $\theta_1^* < \theta_2^* < ... < \theta_{K-1}^*$
- **尺度参数正性**：通过 $\exp$ 变换确保 $\gamma$ 参数为正
- **路径平衡**：避免单一路径主导的问题

## 7. 理论意义

CAAC-SPSFT的设计体现了几个重要的理论原则：

1. **因果机制的稳定性**：决策机制不应该依赖于特定的输入
2. **分布鲁棒性**：柯西分布的重尾特性提供天然的异常值鲁棒性
3. **计算可行性**：封闭解析形式确保高效的训练和推理
4. **模型可解释性**：清晰的分层结构支持因果推理

这些原则的结合使得CAAC-SPSFT成为一个理论上严格、实用性强的分类模型，为因果推断在机器学习中的应用提供了新的范式。
