# 模型架构

## 整体架构设计

基于对CAAR和CAAC项目的分析，结合理论设计文档，我们设计了全新的共享潜在柯西向量的OvR多分类器架构。该架构保留CAAR的模块化三段式结构，同时引入共享潜在柯西向量和OvR策略，以解决CAAC在分类任务上的不足。

## 模块组成

新架构由以下核心模块组成：

### 1. 特征网络 (FeatureNetwork)

特征网络负责从原始输入特征中提取高级表征，为后续的推断网络提供基础。

- **输入**：原始特征 x ∈ ℝᴰ
- **输出**：高维表征 z ∈ ℝᴸ
- **功能**：提取输入特征的高级表征

特征网络采用多层感知机（MLP）结构，通过多个全连接层和非线性激活函数（ReLU）将原始特征映射到高维表征空间。

### 2. 推断网络 (AbductionNetwork)

推断网络负责从高维表征中推断共享潜在柯西随机向量的参数。

- **输入**：高维表征 z ∈ ℝᴸ
- **输出**：潜在柯西向量参数 (μ₁...μₘ, σ₁...σₘ)
- **功能**：推断共享潜在柯西随机向量的参数

推断网络首先通过共享的多层感知机处理高维表征，然后分别通过两个独立的线性层预测潜在柯西向量的位置参数和尺度参数。尺度参数通过softplus函数确保为正值。

### 3. 线性变换层 (LinearTransformationLayer)

线性变换层负责将潜在柯西向量映射到各类别得分随机变量。

- **输入**：潜在柯西向量参数 (μ₁...μₘ, σ₁...σₘ)
- **输出**：N个类别的得分随机变量参数 (loc₁...locₙ, scale₁...scaleₙ)
- **功能**：将潜在柯西向量映射到各类别得分随机变量

线性变换层包含一个可学习的权重矩阵和偏置向量，利用柯西分布的线性组合特性，将潜在柯西向量映射到各类别得分随机变量。

### 4. OvR概率计算层 (OvRProbabilityLayer)

OvR概率计算层负责计算样本属于每个类别的概率。

- **输入**：类别得分随机变量参数 (loc₁...locₙ, scale₁...scaleₙ)
- **输出**：N个类别的概率 P₁...Pₙ
- **功能**：计算样本属于每个类别的概率

OvR概率计算层利用柯西分布的CDF计算每个类别得分随机变量超过阈值的概率，作为样本属于该类别的概率。

### 5. 统一分类网络 (UnifiedClassificationNetwork)

统一分类网络整合了上述所有模块，构建完整的分类器。

- **输入**：原始特征 x ∈ ℝᴰ
- **输出**：类别概率 P₁...Pₙ
- **功能**：端到端的分类预测

统一分类网络按照特征提取、推断潜在柯西向量参数、线性变换到类别得分随机变量、计算类别概率的顺序进行前向传播，实现端到端的分类预测。

## 数据流图

```
输入特征 x
    ↓
FeatureNetwork
    ↓
高维表征 z
    ↓
AbductionNetwork
    ↓
潜在柯西向量参数 (μ₁...μₘ, σ₁...σₘ)
    ↓
LinearTransformationLayer
    ↓
类别得分随机变量参数 (loc₁...locₙ, scale₁...scaleₙ)
    ↓
OvRProbabilityLayer
    ↓
类别概率 P₁...Pₙ
    ↓
预测类别 = argmax(P₁...Pₙ)
```

## 模型包装类 (CAACOvRModel)

模型包装类封装了统一分类网络，提供了训练、验证和预测功能。

- **训练**：使用OvR策略的二元交叉熵损失，支持早停和最佳模型保存
- **验证**：计算验证集上的损失和准确率
- **预测**：预测类别概率和类别标签
- **参数管理**：获取和设置模型参数

## 模型特性与优势

1. **共享潜在柯西向量**：所有类别共享同一个潜在柯西随机向量，隐式捕获类别间的相关性。

2. **OvR策略**：将N类问题分解为N个二分类问题，提高并行性和可扩展性。

3. **精确的不确定性建模**：通过柯西分布的位置参数和尺度参数，为每个类别判决提供"中心"和"模糊度"量化。

4. **线性变换特性**：利用柯西分布的线性组合特性，确保类别得分随机变量仍然服从柯西分布。

5. **模块化设计**：清晰的模块化结构，便于扩展和维护。
